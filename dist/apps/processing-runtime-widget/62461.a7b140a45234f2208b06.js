"use strict";(self.webpackChunkcumulocity_processing_widget_plugin=self.webpackChunkcumulocity_processing_widget_plugin||[]).push([[62461],{62461:function(e,t,r){r.r(t),r.d(t,{FormlyJsonschema:function(){return p}});var n=r(58156),i=r(40761),o=r(24219),a=r(94814);function u(e){return""===e||null==e}function s(e){return e.hasOwnProperty("const")||e.enum&&1===e.enum.length}function l(e){return e.fieldGroup?e.fieldGroup.reduce((function(e,t){return l(t)+e}),0):e.key&&void 0!==(0,a["ɵgetFieldInitialValue"])(e)?1:0}var p=function(){function e(){}return e.prototype.toFieldConfig=function(e,t){return this._toFieldConfig(e,(0,n.__assign)({schema:e},t||{}))},e.prototype._toFieldConfig=function(e,t){var r=this;e=this.resolveSchema(e,t);var i={type:this.guessType(e),defaultValue:e.default,templateOptions:{label:e.title,readonly:e.readOnly,description:e.description}};switch(t.ignoreDefault||!e.readOnly&&!t.readOnly||(i.templateOptions.disabled=!0,t=(0,n.__assign)({},t,{readOnly:!0})),t.resetOnHide&&(i.resetOnHide=!0),!1===t.shareFormControl&&(i.shareFormControl=!1),t.ignoreDefault&&delete i.defaultValue,i.type){case"null":this.addValidator(i,"null",(function(e){return null===e.value}));break;case"number":case"integer":i.parsers=[function(e){return u(e)?null:Number(e)}],e.hasOwnProperty("minimum")&&(i.templateOptions.min=e.minimum),e.hasOwnProperty("maximum")&&(i.templateOptions.max=e.maximum),e.hasOwnProperty("exclusiveMinimum")&&(i.templateOptions.exclusiveMinimum=e.exclusiveMinimum,this.addValidator(i,"exclusiveMinimum",(function(t){var r=t.value;return u(r)||r>e.exclusiveMinimum}))),e.hasOwnProperty("exclusiveMaximum")&&(i.templateOptions.exclusiveMaximum=e.exclusiveMaximum,this.addValidator(i,"exclusiveMaximum",(function(t){var r=t.value;return u(r)||r<e.exclusiveMaximum}))),e.hasOwnProperty("multipleOf")&&(i.templateOptions.step=e.multipleOf,this.addValidator(i,"multipleOf",(function(t){var r=t.value;return!!(u(r)||"number"!=typeof r||0===r||e.multipleOf<=0)||function(e){return Number.isInteger?Number.isInteger(e):"number"==typeof e&&Math.floor(e)===e}(r/e.multipleOf)})));break;case"string":var o=e.type;Array.isArray(o)&&-1!==o.indexOf("null")&&(i.parsers=[function(e){return u(e)?null:e}]),["minLength","maxLength","pattern"].forEach((function(t){e.hasOwnProperty(t)&&(i.templateOptions[t]=e[t])}));break;case"object":i.fieldGroup=[];var l=(0,n.__read)(this.resolveDependencies(e),2),p=l[0],m=l[1];Object.keys(e.properties||{}).forEach((function(o){var a=r._toFieldConfig(e.properties[o],t);if(i.fieldGroup.push(a),a.key=o,Array.isArray(e.required)&&-1!==e.required.indexOf(o)&&(a.templateOptions.required=!0),a.templateOptions&&!a.templateOptions.required&&p[o]&&(a.expressionProperties={"templateOptions.required":function(e){return e&&p[o].some((function(t){return!u(e[t])}))}}),m[o]){var l=m[o].oneOf;l&&l.every((function(e){return e.properties&&e.properties[o]&&s(e.properties[o])}))?l.forEach((function(e){var a=e.properties,u=o,s=a[u],l=(0,n.__rest)(a,["symbol"==typeof u?u:u+""]);i.fieldGroup.push((0,n.__assign)({},r._toFieldConfig((0,n.__assign)({},e,{properties:l}),(0,n.__assign)({},t,{resetOnHide:!0})),{hideExpression:function(e){return!e||((t=s).hasOwnProperty("const")?t.const:t.enum[0])!==e[o];var t}}))})):i.fieldGroup.push((0,n.__assign)({},r._toFieldConfig(m[o],t),{hideExpression:function(e){return!e||u(e[o])}}))}})),e.oneOf&&i.fieldGroup.push(this.resolveMultiSchema("oneOf",e.oneOf,(0,n.__assign)({},t,{shareFormControl:!1}))),e.anyOf&&i.fieldGroup.push(this.resolveMultiSchema("anyOf",e.anyOf,t));break;case"array":if(e.hasOwnProperty("minItems")&&(i.templateOptions.minItems=e.minItems,this.addValidator(i,"minItems",(function(t){var r=t.value;return u(r)||r.length>=e.minItems}))),e.hasOwnProperty("maxItems")&&(i.templateOptions.maxItems=e.maxItems,this.addValidator(i,"maxItems",(function(t){var r=t.value;return u(r)||r.length<=e.maxItems}))),e.hasOwnProperty("uniqueItems")&&(i.templateOptions.uniqueItems=e.uniqueItems,this.addValidator(i,"uniqueItems",(function(t){var r=t.value;return!(!u(r)&&e.uniqueItems)||Array.from(new Set(r.map((function(e){return JSON.stringify(e)})))).length===r.length}))),e.items&&!Array.isArray(e.items)&&(e.items=this.resolveSchema(e.items,t)),!this.isEnum(e)){var f=this;Object.defineProperty(i,"fieldArray",{get:function(){if(!Array.isArray(e.items))return f._toFieldConfig(e.items,t);var r=this.fieldGroup?this.fieldGroup.length:0,n=e.items[r]?e.items[r]:e.additionalItems;return n?f._toFieldConfig(n,t):{}},enumerable:!0,configurable:!0})}}return e.hasOwnProperty("const")&&(i.templateOptions.const=e.const,this.addValidator(i,"const",(function(t){return t.value===e.const})),i.type||(i.defaultValue=e.const)),this.isEnum(e)&&(i.templateOptions.multiple="array"===i.type,i.type="enum",i.templateOptions.options=this.toEnumOptions(e)),e.widget&&e.widget.formlyConfig&&(i=(0,a["ɵreverseDeepMerge"])(e.widget.formlyConfig,i)),t.map?t.map(i,e):i},e.prototype.resolveSchema=function(e,t){return e.$ref&&(e=this.resolveDefinition(e,t)),e.allOf&&(e=this.resolveAllOf(e,t)),e},e.prototype.resolveAllOf=function(e,t){var r=this,i=e.allOf,o=(0,n.__rest)(e,["allOf"]);if(!i.length)throw Error("allOf array can not be empty "+i+".");return i.reduce((function(e,i){return i=r.resolveSchema(i,t),e.required&&i.required&&(e.required=(0,n.__spread)(e.required,i.required)),i.uniqueItems&&(e.uniqueItems=i.uniqueItems),["maxLength","maximum","exclusiveMaximum","maxItems","maxProperties"].forEach((function(t){u(e[t])||u(i[t])||(e[t]=e[t]<i[t]?e[t]:i[t])})),["minLength","minimum","exclusiveMinimum","minItems","minProperties"].forEach((function(t){u(e[t])||u(i[t])||(e[t]=e[t]>i[t]?e[t]:i[t])})),(0,a["ɵreverseDeepMerge"])(e,i)}),o)},e.prototype.resolveMultiSchema=function(e,t,r){var i=this;return{type:"multischema",fieldGroup:[{type:"enum",defaultValue:-1,templateOptions:{multiple:"anyOf"===e,options:t.map((function(e,t){return{label:e.title,value:t,disabled:e.readOnly}}))}},{fieldGroup:t.map((function(o,a){return(0,n.__assign)({},i._toFieldConfig(o,(0,n.__assign)({},r,{resetOnHide:!0})),{hideExpression:function(o,u,s){var p=s.parent.parent.fieldGroup[0].formControl;if(-1===p.value){var m=s.parent.fieldGroup.map((function(e,t){return[e,t]})).filter((function(e){var o=(0,n.__read)(e,2),a=o[0],u=o[1];return console.warn("---",p.value),i.isFieldValid(a,t[u],r)})).sort((function(e,t){var r=(0,n.__read)(e,1)[0],i=(0,n.__read)(t,1)[0],o=l(r),a=l(i);return o===a?r.templateOptions.disabled===i.templateOptions.disabled?0:r.templateOptions.disabled?1:-1:a>o?1:-1})).map((function(e){return(0,n.__read)(e,2)[1]})),f=[0===m.length?0:m[0]],d="anyOf"===e?f:f[0];p.setValue(d)}return Array.isArray(p.value)?-1===p.value.indexOf(a):p.value!==a}})}))}]}},e.prototype.resolveDefinition=function(e,t){var r=(0,n.__read)(e.$ref.split("#/"),2),i=r[0],o=r[1];if(i)throw Error("Remote schemas for "+e.$ref+" not supported yet.");var a=o?o.split("/").reduce((function(e,t){return e&&e.hasOwnProperty(t)?e[t]:null}),t.schema):null;if(!a)throw Error("Cannot find a definition for "+e.$ref+".");return a.$ref?this.resolveDefinition(a,t):(0,n.__assign)({},a,["title","description","default"].reduce((function(t,r){return e.hasOwnProperty(r)&&(t[r]=e[r]),t}),{}))},e.prototype.resolveDependencies=function(e){var t={},r={};return Object.keys(e.dependencies||{}).forEach((function(n){var i=e.dependencies[n];Array.isArray(i)?i.forEach((function(e){t[e]?t[e].push(n):t[e]=[n]})):r[n]=i})),[t,r]},e.prototype.guessType=function(e){var t=e.type;if(!t&&e.properties)return"object";if(Array.isArray(t)){if(1===t.length)return t[0];if(2===t.length&&-1!==t.indexOf("null"))return t["null"===t[0]?1:0]}return t},e.prototype.addValidator=function(e,t,r){e.validators=e.validators||{},e.validators[t]=r},e.prototype.isEnum=function(e){return e.enum||e.anyOf&&e.anyOf.every(s)||e.oneOf&&e.oneOf.every(s)||e.uniqueItems&&e.items&&!Array.isArray(e.items)&&this.isEnum(e.items)},e.prototype.toEnumOptions=function(e){if(e.enum)return e.enum.map((function(e){return{value:e,label:e}}));var t=function(e){var t=e.hasOwnProperty("const")?e.const:e.enum[0],r={value:t,label:e.title||t};return e.readOnly&&(r.disabled=!0),r};return e.anyOf?e.anyOf.map(t):e.oneOf?e.oneOf.map(t):this.toEnumOptions(e.items)},e.prototype.isFieldValid=function(e,t,r){return e.options._buildField({form:new o.FormGroup({}),fieldGroup:[this._toFieldConfig(t,(0,n.__assign)({},r,{resetOnHide:!0,ignoreDefault:!0,map:null}))],model:e.model?(0,a["ɵclone"])(e.model):e.fieldArray?[]:{}}).form.valid},e.ngInjectableDef=(0,i.defineInjectable)({factory:function(){return new e},token:e,providedIn:"root"}),e.ɵfac=function(t){return new(t||e)},e.ɵprov=i["ɵɵdefineInjectable"]({token:e,factory:function(t){return e.ɵfac(t)},providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&i["ɵsetClassMetadata"](e,[{type:i.Injectable,args:[{providedIn:"root"}]}],(function(){return[]}),null),e}()}}]);